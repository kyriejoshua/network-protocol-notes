## 协议三要素

### 语法

**一段内容所需要符合的格式和规则：例如括号需要闭合，结束要使用分号;**

### 语义

**一段内容要代表具体的意义：数字减去数字是有意义的，数字减去字符是没有意义的;**

### 顺序

**按照顺序执行指令：数字先加上数值，再乘以某个数值。**

### 命令行查看返回内容

执行一段命令，查看百度的返回内容（why 百度，因为百度的返回相对比较简单
* `curl -v https://www.baidu.com`

```shell
* Trying 36.152.44.95:443...
* Connected to www.baidu.com (36.152.44.95) port 443 (#0)
* ALPN: offers h2
* ALPN: offers http/1.1
*  CAfile: /etc/ssl/cert.pem
*  CApath: none
* (304) (OUT), TLS handshake, Client hello (1):
* (304) (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
* TLSv1.2 (IN), TLS handshake, Server finished (14):
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (OUT), TLS handshake, Finished (20):
* TLSv1.2 (IN), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (IN), TLS handshake, Finished (20):
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: C=CN; ST=beijing; L=beijing; OU=service operation department; O=Beijing Baidu Netcom Science Technology Co., Ltd; CN=baidu.com
*  start date: Jul  5 05:16:02 2022 GMT
*  expire date: Aug  6 05:16:01 2023 GMT
*  subjectAltName: host "www.baidu.com" matched cert's "*.baidu.com"
*  issuer: C=BE; O=GlobalSign nv-sa; CN=GlobalSign RSA OV SSL CA 2018
*  SSL certificate verify ok.
> GET / HTTP/1.1
> Host: www.baidu.com
> User-Agent: curl/7.86.0
> Accept: */*
>
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< Accept-Ranges: bytes
< Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform
< Connection: keep-alive
< Content-Length: 2443
< Content-Type: text/html
< Date: Wed, 08 Feb 2023 14:43:24 GMT
< Etag: "5886041d-98b"
< Last-Modified: Mon, 23 Jan 2017 13:24:45 GMT
< Pragma: no-cache
< Server: bfe/1.0.8.18
< Set-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/
<
<!DOCTYPE html>
<!--STATUS OK--><html> <head><meta http-equiv=content-type content=text/html;charset=utf-8><meta http-equiv=X-UA-Compatible content=IE=Edge><meta content=always name=referrer><link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css><title>百度一下，你就知道</title></head> <body link=#0000cc> <div id=wrapper> <div id=head> <div class=head_wrapper> <div class=s_form> <div class=s_form_wrapper> <div id=lg> <img hidefocus=true src=//www.baidu.com/img/bd_logo1.png width=270 height=129> </div> <form id=form name=f action=//www.baidu.com/s class=fm> <input type=hidden name=bdorz_come value=1> <input type=hidden name=ie value=utf-8> <input type=hidden name=f value=8> <input type=hidden name=rsv_bp value=1> <input type=hidden name=rsv_idx value=1> <input type=hidden name=tn value=baidu><span class="bg s_ipt_wr"><input id=kw name=wd class=s_ipt value maxlength=255 autocomplete=off autofocus=autofocus></span><span class="bg s_btn_wr"><input type=submit id=su value=百度一下 class="bg s_btn" autofocus></span> </form> </div> </div> <div id=u1> <a href=http://news.baidu.com name=tj_trnews class=mnav>新闻</a> <a href=https://www.hao123.com name=tj_trhao123 class=mnav>hao123</a> <a href=http://map.baidu.com name=tj_trmap class=mnav>地图</a> <a href=http://v.baidu.com name=tj_trvideo class=mnav>视频</a> <a href=http://tieba.baidu.com name=tj_trtieba class=mnav>贴吧</a> <noscript> <a href=http://www.baidu.com/bdorz/login.gif?login&amp;tpl=mn&amp;u=http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1 name=tj_login class=lb>登录</a> </noscript> <script>document.write('<a href="http://www.baidu.com/bdorz/login.gif?login&tpl=mn&u='+ encodeURIComponent(window.location.href+ (window.location.search === "" ? "?" : "&")+ "bdorz_come=1")+ '" name="tj_login" class="lb">登录</a>');
                </script> <a href=//www.baidu.com/more/ name=tj_briicon class=bri style="display: block;">更多产品</a> </div> </div> </div> <div id=ftCon> <div id=ftConw> <p id=lh> <a href=http://home.baidu.com>关于百度</a> <a href=http://ir.baidu.com>About Baidu</a> </p> <p id=cp>&copy;2017&nbsp;Baidu&nbsp;<a href=http://www.baidu.com/duty/>使用百度前必读</a>&nbsp; <a href=http://jianyi.baidu.com/ class=cp-feedback>意见反馈</a>&nbsp;京ICP证030173号&nbsp; <img src=//www.baidu.com/img/gs.gif> </p> </div> </div> </div> </body> </html>
* Connection #0 to host www.baidu.com left intact
```

这里我们需要关注的是 200 之后的部分，也就是状态码之后的内容。共有三个方面：
1. 状态码之后，是响应头参数，响应体内容（HTML），这样的格式符合上面所说的符合语法。
2. 状态码 200 表示请求成功返回，也就是符合语义。
3. 上面的所有内容是按顺序展示的，最前面的部分表示了请求执行的顺序，以及请求后所得到的响应。

> [网络协议-极客时间](https://time.geekbang.org/column/article/8975)

## 网络分层

### 网络为什么要分层

* 因为复杂的程序都需要分层，这是程序设计的要求。每一层专注于做自己分内的事，将复杂度解耦。

### 网络如何分层

#### TCP/IP 网络模型

| 网络分层 | 对应内容                         |
| -------- | -------------------------------- |
| 应用层   | HTTP、FTP、DNS、RPC、DHCP、HTTPS |
| 传输层   | UDP、TCP                        |
| 网络层   | IP、ARP                          |
| 链路层   | MAC                              |
| 物理层   | 网络跳线                         |

* *有时把链路层和物理层统称为网络接口层。*

#### OSI 网络模型

* **按 OSI 七层级划分的话，在应用层下面有表现层和会话层。** [参考](https://developer.aliyun.com/article/47151)

| 网络分层 | 对应内容                         |
| -------- | -------------------------------- |
| 应用层   | FTP、DHCP、POP3、SMTP |
| 表现层   |         转换、压缩、和加密 SSL               |
| 会话层   | |
| 传输层   |         TCP、UDP                      |
| 网络层   | 路由器                       |
| 数据链路层   | 交换机                     |
| 物理层         |                                  网卡、集线器|

#### 分层举例

| 协议          | 举例内容                                                                |
| ------------- | ----------------------------------------------------------------------- |
| MAC 头        | 客户端电脑 MAC: 192.168.1.101 的 MAC<br/>网关的 MAC: 192.168.1.1 的 MAC |
| IP 头         | 客户端电脑 IP: 192.168.1.101 <br/> 电商服务器 IP: 106.114.138.24        |
| TCP 头        | 浏览器端口: 12345 <br/> 电商应用端口: 443                               |
| HTTP 头       | POST, URL, HTTP 1.1 <br/> 正文格式: json 正文长度 1234                  |
| 请求体/响应体 | 我要买什么，买多少                                                      |


#### 网络的执行过程

![](https://static001.geekbang.org/resource/image/5c/76/5c00f6e610f533d17fb4ad7decacc776.jpg?wh=3226*3472)

### TCP/IP 网络模型

所谓某层设备，就是设备上跑的程序不同。例如二层设备解析的是 mac 头，三层设备解析的是 mac 头 和 ip 头。
每层设备会摘下并解析对应的包头，并做出相应的行为，包括**丢弃、转发、或留下**等。
* 二层设备摘下并解析 mac 头；
* 三层设备摘下并解析 ip 头；
* 四层设备摘下并解析 tcp 头；

最终在四层头里，会有一个端口号，系统中的应用会监听不同的端口号，如果发现浏览器应用正在监听这个端口，那么就把这个网络包交给浏览器处理。
到这里网络层面的事就结束了。
浏览器接收到网络包以后，执行解析 html 页面或者其他操作。
**只要是在网络上跑的包，都是完整的。包可以有下层没有上层，不可能有上层没下层。**
* 包之间是层层依赖的，上层依赖下层。
* 对于 tcp 协议来说，只要发送出去的包，一定是带有 mac 层和 ip 层的，否则无法发送。